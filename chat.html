<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Semester Chat</title>
  <style>
    body { margin:0; font-family: Arial; display:flex; flex-direction:column; height:100vh; }
    header { background:#0b74ff; color:#fff; padding:10px; text-align:center; font-weight:bold; }
    #messages { flex:1; padding:10px; overflow-y:auto; background:#f5f6fa; display:flex; flex-direction:column; }
    .msg { margin:6px 0; padding:8px 12px; border-radius:12px; max-width:70%; word-wrap:break-word; }
    .mine { background:#d1e7ff; align-self:flex-end; }
    .other { background:#fff; border:1px solid #ddd; align-self:flex-start; }
    footer { display:flex; padding:8px; background:#fff; border-top:1px solid #ccc; }
    input { flex:1; padding:10px; border:1px solid #ccc; border-radius:8px; }
    button { margin-left:8px; background:#0b74ff; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <header id="roomTitle">Semester Chat</header>
  <div id="messages"></div>
  <footer>
    <input id="msgBox" placeholder="Type a message..."/>
    <button onclick="sendMessage()">Send</button>
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    // ðŸ”¹ Replace with your Firebase project config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com", // must be enabled in Firebase console
      projectId: "YOUR_PROJECT"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ðŸŽ“ Semester = chat room name
    const sem = localStorage.getItem("semester") || "Anonymous";
    document.getElementById("roomTitle").innerText = sem + " Discussion";

    // ðŸŽ“ Unique ID for this user (so we know which messages are "mine")
    const myId = "user_" + Math.random().toString(36).substring(2,10);

    const msgRef = ref(db, "chats/" + sem);
    const messagesEl = document.getElementById("messages");
    const msgBox = document.getElementById("msgBox");

    // âœ… Listen for new messages (everyone in the room sees them live)
    onChildAdded(msgRef, snap => {
      const data = snap.val();
      const div = document.createElement("div");
      div.className = "msg " + (data.senderId === myId ? "mine" : "other");
      div.innerHTML = `<b>${data.sender}:</b> ${data.text}`;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight; // auto scroll
    });

    // âœ… Send new message
    function sendMessage(){
      let text = msgBox.value.trim();
      if(!text) return;
      push(msgRef, {
        senderId: myId,
        sender: sem, // default name = semester
        text: text,
        time: serverTimestamp()
      });
      msgBox.value = "";
    }
    window.sendMessage = sendMessage;
  </script>
</body>
</html>
